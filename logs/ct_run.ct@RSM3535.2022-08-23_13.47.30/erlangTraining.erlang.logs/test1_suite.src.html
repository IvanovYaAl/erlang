<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/home/iaroslav/GitLabs/erlangTraining/erlang/test1_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <b>-module</b>(test1_SUITE).
<a name="2"/>    2: <b>-compile</b>(export_all).
<a name="3"/>    3: 
<a name="4"/>    4: <b>-include_lib</b>(&quot;eunit/include/eunit.hrl&quot;).
<a name="5"/>    5: 
<a name="all-0"/><a name="6"/>    6: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="7"/>    7:   [
<a name="8"/>    8:     demo_test,
<a name="9"/>    9:     temp_test,
<a name="10"/>   10:     mathStuff_test,
<a name="11"/>   11:     lists1_test,
<a name="12"/>   12:     time_test,
<a name="13"/>   13: <i>%% NOTE: The tests below possibly requires interface change in test exercise.</i>
<a name="14"/>   14: <i>%% NOTE: The tests below should be run manually to check the correctness of message sending/receiving.</i>
<a name="15"/>   15:     two_proc_test,
<a name="16"/>   16:     ring_test,
<a name="17"/>   17:     star_test,
<a name="18"/>   18:     ms_test,
<a name="19"/>   19:     two_proc_test_boundary,
<a name="20"/>   20:     ring_test_boundary,
<a name="21"/>   21:     star_test_boundary,
<a name="22"/>   22:     ms_test_boundary
<a name="23"/>   23:   ].
<a name="24"/>   24: 
<a name="log_start-1"/><a name="log_start-last_expr"/><a name="25"/>   25: <b>log_start</b>(FuncName)  -&gt; ct:print(&quot;========== Start ~p ==========&quot;, [FuncName]).
<a name="log_finish-1"/><a name="log_finish-last_expr"/><a name="26"/>   26: <b>log_finish</b>(FuncName) -&gt; ct:print(&quot;========== Finish ~p ==========&quot;, [FuncName]).
<a name="27"/>   27: 
<a name="swedish_year-1"/><a name="swedish_year-last_expr"/><a name="28"/>   28: <b>swedish_year</b>(Y) -&gt; lists:nthtail(2, integer_to_list(Y)).
<a name="swedish_month_day-1"/><a name="29"/>   29: <b>swedish_month_day</b>(X) when X &gt; 9 -&gt; integer_to_list(X);
<a name="swedish_month_day-last_expr"/><a name="30"/>   30: <b>swedish_month_day</b>(X) -&gt; &quot;0&quot; ++ integer_to_list(X).
<a name="swedish_date_ref-0"/><a name="31"/>   31: <b>swedish_date_ref</b>() -&gt;
<a name="32"/>   32:   {Y, M, D} = date(),
<a name="swedish_date_ref-last_expr"/><a name="33"/>   33: <b>  swedish_year</b>(Y) ++ swedish_month_day(M) ++ swedish_month_day(D).
<a name="34"/>   34: 
<a name="demo_test-1"/><a name="35"/>   35: <b>demo_test</b>(_) -&gt;
<a name="36"/>   36:   log_start(?FUNCTION_NAME),
<a name="37"/>   37:   ?assertEqual(demo:double(5), 10),
<a name="demo_test-last_expr"/><a name="38"/>   38: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="39"/>   39: 
<a name="temp_test-1"/><a name="40"/>   40: <b>temp_test</b>(_) -&gt;
<a name="41"/>   41:   log_start(?FUNCTION_NAME),
<a name="42"/>   42:   ?assert(temp:f2c(248) == 120),
<a name="43"/>   43:   ?assert(temp:f2c(-4) == -20),
<a name="44"/>   44:   ?assert(temp:c2f(120) == 248),
<a name="45"/>   45:   ?assert(temp:c2f(-20) == -4),
<a name="46"/>   46:   ?assert(temp:convert({f, 248}) == {c, 120}),
<a name="47"/>   47:   ?assert(temp:convert({f, -4})  == {c, -20}),
<a name="48"/>   48:   ?assert(temp:convert({c, 120}) == {f, 248}),
<a name="49"/>   49:   ?assert(temp:convert({c, -20}) == {f, -4}),
<a name="50"/>   50:   ?assert(temp:convert({f, 72.5}) == {c, 22.5}),
<a name="51"/>   51:   ?assert(temp:convert({c, 22.5}) == {f, 72.5}),
<a name="temp_test-last_expr"/><a name="52"/>   52: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="53"/>   53: 
<a name="mathStuff_test-1"/><a name="54"/>   54: <b>mathStuff_test</b>(_) -&gt;
<a name="55"/>   55:   log_start(?FUNCTION_NAME),
<a name="56"/>   56:   ?assertEqual(mathStuff:perimeter({square, 3}), 12),
<a name="57"/>   57:   ?assertEqual(mathStuff:perimeter({circle, 10}), 20 * math:pi()),
<a name="58"/>   58:   ?assertEqual(mathStuff:perimeter({triangle, 3, 4, 5}), 12),
<a name="mathStuff_test-last_expr"/><a name="59"/>   59: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="60"/>   60: 
<a name="lists1_test-1"/><a name="61"/>   61: <b>lists1_test</b>(_) -&gt;
<a name="62"/>   62:   log_start(?FUNCTION_NAME),
<a name="63"/>   63:   ?assertEqual(lists1:min([5]), 5),
<a name="64"/>   64:   ?assertEqual(lists1:max([5]), 5),
<a name="65"/>   65:   ?assertEqual(lists1:min_max([5]), {5, 5}),
<a name="66"/>   66:   ?assertEqual(lists1:min([1,2,-5,-4,4,10,2,5,11,2,0]), -5),
<a name="67"/>   67:   ?assertEqual(lists1:max([1,2,-5,-4,4,10,2,5,11,2,0]), 11),
<a name="68"/>   68:   ?assertEqual(lists1:min_max([1,2,-5,-4,4,10,2,5,11,2,0]), {-5, 11}),
<a name="69"/>   69:   ?assertEqual(lists1:min([1,2,-5,-4,4,10,2,5,11,2,0,-6]), -6),
<a name="70"/>   70:   ?assertEqual(lists1:max([1,2,-5,-4,4,10,2,5,11,2,0,15]), 15),
<a name="71"/>   71:   ?assertEqual(lists1:min_max([1,2,-5,-4,4,10,2,5,11,2,0,-6]), {-6, 11}),
<a name="lists1_test-last_expr"/><a name="72"/>   72: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="73"/>   73: 
<a name="time_test-1"/><a name="74"/>   74: <b>time_test</b>(_) -&gt;
<a name="75"/>   75:   log_start(?FUNCTION_NAME),
<a name="76"/>   76:   ?assertEqual(time:swedish_date(), swedish_date_ref()),
<a name="time_test-last_expr"/><a name="77"/>   77: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="78"/>   78: 
<a name="two_proc_test-1"/><a name="79"/>   79: <b>two_proc_test</b>(_) -&gt;
<a name="80"/>   80:   log_start(?FUNCTION_NAME),
<a name="81"/>   81:   two_proc_test_common(3),
<a name="two_proc_test-last_expr"/><a name="82"/>   82: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="83"/>   83: 
<a name="two_proc_test_boundary-1"/><a name="84"/>   84: <b>two_proc_test_boundary</b>(_) -&gt;
<a name="85"/>   85:   log_start(?FUNCTION_NAME),
<a name="86"/>   86:   two_proc_test_common(1),
<a name="two_proc_test_boundary-last_expr"/><a name="87"/>   87: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="88"/>   88: 
<a name="two_proc_test_common-1"/><a name="89"/>   89: <b>two_proc_test_common</b>(NumOfMsg) -&gt;
<a name="90"/>   90:   log_start(?FUNCTION_NAME),
<a name="91"/>   91:   log_start(lists:flatten(io_lib:format(&quot;NumOfMsg = ~p&quot;, [NumOfMsg]))),
<a name="92"/>   92: 
<a name="93"/>   93:   case code:ensure_loaded(two_proc) of
<a name="94"/>   94:     {error, _What} -&gt;
<a name="95"/>   95:       ct:fail(&quot;Please rename module as 'two_proc' to proceed the test&quot;);
<a name="96"/>   96:     _ -&gt;
<a name="97"/>   97:       Exported1 = erlang:function_exported(two_proc, start, 1),
<a name="98"/>   98:       Exported2 = erlang:function_exported(two_proc, send_msg, 4),
<a name="99"/>   99:       case Exported1 and Exported2 of
<a name="100"/>  100:         true -&gt; ok;
<a name="101"/>  101:         false -&gt;
<a name="102"/>  102:           ct:print(&quot;!!!!!!!!!! Please change the interface to following: !!!!!!!!!!~n&quot;
<a name="103"/>  103:           &quot;two_proc:start(NumOfMsg) -&gt; {Pid1, Pid2}~n&quot;
<a name="104"/>  104:           &quot;two_proc:send_msg(Pid1, Pid2, MessageString, NumOfMsg) -&gt; ok&quot;, []),
<a name="105"/>  105:           ct:fail(&quot;Please change the interface of 'two_proc' module to proceed the test&quot;)
<a name="106"/>  106:       end
<a name="107"/>  107:   end,
<a name="108"/>  108: 
<a name="109"/>  109:   ct:print(&quot;Start 2 processes&quot;),
<a name="110"/>  110:   {Sender, Receiver} = two_proc:start(NumOfMsg),
<a name="111"/>  111:   ?assertEqual(true, is_process_alive(Sender)),
<a name="112"/>  112:   ?assertEqual(true, is_process_alive(Receiver)),
<a name="113"/>  113: 
<a name="114"/>  114:   ct:print(&quot;Test 2 processes exchange ~p message(s)&quot;, [NumOfMsg]),
<a name="115"/>  115:   two_proc:send_msg(Sender, Receiver, &quot;My msg&quot;, NumOfMsg),
<a name="116"/>  116:   timer:sleep(1000),
<a name="117"/>  117: 
<a name="118"/>  118:   ct:print(&quot;Check all processes are terminated after all messages have been sent&quot;),
<a name="119"/>  119:   ?assertEqual(false, is_process_alive(Sender)),
<a name="120"/>  120:   ?assertEqual(false, is_process_alive(Receiver)),
<a name="two_proc_test_common-last_expr"/><a name="121"/>  121: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="122"/>  122: 
<a name="ring_test-1"/><a name="123"/>  123: <b>ring_test</b>(_) -&gt;
<a name="124"/>  124:   log_start(?FUNCTION_NAME),
<a name="125"/>  125:   ring_test_common(5, 3),
<a name="ring_test-last_expr"/><a name="126"/>  126: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="127"/>  127: 
<a name="ring_test_boundary-1"/><a name="128"/>  128: <b>ring_test_boundary</b>(_) -&gt;
<a name="129"/>  129:   log_start(?FUNCTION_NAME),
<a name="130"/>  130:   ring_test_common(1, 1),
<a name="ring_test_boundary-last_expr"/><a name="131"/>  131: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="132"/>  132: 
<a name="ring_test_common-2"/><a name="133"/>  133: <b>ring_test_common</b>(NumOfProc, NumOfMsg) -&gt;
<a name="134"/>  134:   log_start(?FUNCTION_NAME),
<a name="135"/>  135: 
<a name="136"/>  136:   case code:ensure_loaded(ring) of
<a name="137"/>  137:     {error, _What} -&gt;
<a name="138"/>  138:       ct:fail(&quot;Please rename module as 'ring' to proceed the test&quot;);
<a name="139"/>  139:     _ -&gt;
<a name="140"/>  140:       Exported1 = erlang:function_exported(ring, start, 1),
<a name="141"/>  141:       Exported2 = erlang:function_exported(ring, send_msg, 3),
<a name="142"/>  142:       case Exported1 and Exported2 of
<a name="143"/>  143:         true -&gt; ok;
<a name="144"/>  144:         false -&gt;
<a name="145"/>  145:           ct:print(&quot;!!!!!!!!!! Please change the interface to following: !!!!!!!!!!~n&quot;
<a name="146"/>  146:           &quot;ring:start(NumOfProc) -&gt; [Pids]~n&quot;
<a name="147"/>  147:           &quot;ring:send_msg([Pids], MessageString, NumOfMsg) -&gt; ok&quot;, []),
<a name="148"/>  148:           ct:fail(&quot;Please change the interface of 'ring' module to proceed the test&quot;)
<a name="149"/>  149:       end
<a name="150"/>  150:   end,
<a name="151"/>  151: 
<a name="152"/>  152:   ct:print(&quot;Start ~p processes&quot;, [NumOfProc]),
<a name="153"/>  153:   Pids = ring:start(NumOfProc),
<a name="154"/>  154:   lists:foreach(
<a name="155"/>  155:     fun(Pid) -&gt; ?assertEqual(true, is_process_alive(Pid)) end, Pids),
<a name="156"/>  156: 
<a name="157"/>  157:   ct:print(&quot;Test ~p processes exchange ~p messages in a ring. Pids: ~p&quot;, [NumOfProc, NumOfMsg, Pids]),
<a name="158"/>  158:   ring:send_msg(Pids, &quot;Ring of power&quot;, NumOfMsg),
<a name="159"/>  159:   timer:sleep(1000),
<a name="160"/>  160: 
<a name="161"/>  161:   ct:print(&quot;Check all processes are terminated after all messages have been sent&quot;),
<a name="162"/>  162:   lists:foreach(
<a name="163"/>  163:     fun(Pid) -&gt; ?assertEqual(false, is_process_alive(Pid)) end, Pids),
<a name="ring_test_common-last_expr"/><a name="164"/>  164: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="165"/>  165: 
<a name="star_test-1"/><a name="166"/>  166: <b>star_test</b>(_) -&gt;
<a name="167"/>  167:   log_start(?FUNCTION_NAME),
<a name="168"/>  168:   star_test_common(5, 3),
<a name="star_test-last_expr"/><a name="169"/>  169: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="170"/>  170: 
<a name="star_test_boundary-1"/><a name="171"/>  171: <b>star_test_boundary</b>(_) -&gt;
<a name="172"/>  172:   log_start(?FUNCTION_NAME),
<a name="173"/>  173:   star_test_common(2, 1),
<a name="star_test_boundary-last_expr"/><a name="174"/>  174: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="175"/>  175: 
<a name="star_test_common-2"/><a name="176"/>  176: <b>star_test_common</b>(NumOfProc, NumOfMsg) -&gt;
<a name="177"/>  177:   log_start(?FUNCTION_NAME),
<a name="178"/>  178: 
<a name="179"/>  179:   case code:ensure_loaded(star) of
<a name="180"/>  180:     {error, _What} -&gt;
<a name="181"/>  181:       ct:fail(&quot;Please rename module as 'star' to proceed the test&quot;);
<a name="182"/>  182:     _ -&gt;
<a name="183"/>  183:       Exported1 = erlang:function_exported(star, start, 1),
<a name="184"/>  184:       Exported2 = erlang:function_exported(star, send_msg, 4),
<a name="185"/>  185:       case Exported1 and Exported2 of
<a name="186"/>  186:         true -&gt; ok;
<a name="187"/>  187:         false -&gt;
<a name="188"/>  188:           ct:print(&quot;!!!!!!!!!! Please change the interface to following: !!!!!!!!!!~n&quot;
<a name="189"/>  189:           &quot;star:start(NumOfProc) -&gt; {CenterPid, [OtherPids]}~n&quot;
<a name="190"/>  190:           &quot;star:send_msg(CenterPid, [OtherPids], MessageString, NumOfMsg) -&gt; ok&quot;, []),
<a name="191"/>  191:           ct:fail(&quot;Please change the interface of 'star' module to proceed the test&quot;)
<a name="192"/>  192:       end
<a name="193"/>  193:   end,
<a name="194"/>  194: 
<a name="195"/>  195:   ct:print(&quot;Start ~p processes in a star topology&quot;, [NumOfProc]),
<a name="196"/>  196:   {Center, Pids} = star:start(NumOfProc),
<a name="197"/>  197:   lists:foreach(
<a name="198"/>  198:     fun(Pid) -&gt; ?assertEqual(true, is_process_alive(Pid)) end, Pids),
<a name="199"/>  199:   ct:print(&quot;Test ~p processes exchange ~p messages in a star. Center: ~p, Pids: ~p&quot;, [NumOfProc, NumOfMsg, Center, Pids]),
<a name="200"/>  200:   star:send_msg(Center, Pids, &quot;Super&quot;, NumOfMsg),
<a name="201"/>  201:   timer:sleep(1000),
<a name="202"/>  202: 
<a name="203"/>  203:   ct:print(&quot;Check all processes are terminated after all messages have been sent&quot;),
<a name="204"/>  204:   ?assertEqual(false, is_process_alive(Center)),
<a name="205"/>  205:   lists:foreach(
<a name="206"/>  206:     fun(Pid) -&gt; ?assertEqual(false, is_process_alive(Pid)) end, Pids),
<a name="star_test_common-last_expr"/><a name="207"/>  207: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="208"/>  208: 
<a name="ms_test-1"/><a name="209"/>  209: <b>ms_test</b>(_) -&gt;
<a name="210"/>  210:   log_start(?FUNCTION_NAME),
<a name="211"/>  211:   ms_test_common(5),
<a name="ms_test-last_expr"/><a name="212"/>  212: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="213"/>  213: 
<a name="ms_test_boundary-1"/><a name="214"/>  214: <b>ms_test_boundary</b>(_) -&gt;
<a name="215"/>  215:   log_start(?FUNCTION_NAME),
<a name="216"/>  216:   ms_test_common(1),
<a name="ms_test_boundary-last_expr"/><a name="217"/>  217: <b>  log_finish</b>(?FUNCTION_NAME).
<a name="218"/>  218: 
<a name="ms_test_common-1"/><a name="219"/>  219: <b>ms_test_common</b>(N) -&gt;
<a name="220"/>  220:   log_start(?FUNCTION_NAME),
<a name="221"/>  221: 
<a name="222"/>  222:   ct:print(&quot;Start the master and ~p slaves&quot;, [N]),
<a name="223"/>  223:   ms:start(N),
<a name="224"/>  224:   ?assertNotEqual(undefined, whereis(master)),
<a name="225"/>  225: 
<a name="226"/>  226:   ct:print(&quot;Send the message from master to slaves&quot;),
<a name="227"/>  227:   [ms:to_slave(&quot;Hi, slave!&quot;, Index) || Index &lt;- lists:seq(1, N)],
<a name="228"/>  228:   timer:sleep(1000),
<a name="229"/>  229: 
<a name="230"/>  230:   case N &lt; 2 of
<a name="231"/>  231:     true -&gt;
<a name="232"/>  232:       skip_test_step;
<a name="233"/>  233:     false -&gt;
<a name="234"/>  234:       ct:print(&quot;Restart one slave with 'die' message&quot;),
<a name="235"/>  235:       ms:to_slave(die, 2),
<a name="236"/>  236:       timer:sleep(1000),
<a name="237"/>  237: 
<a name="238"/>  238:       ct:print(&quot;Send the message again to check the slave is restarted&quot;),
<a name="239"/>  239:       [ms:to_slave(&quot;Hi, slave!&quot;, Index) || Index &lt;- lists:seq(1, N)],
<a name="240"/>  240:       timer:sleep(1000)
<a name="241"/>  241:   end,
<a name="242"/>  242: 
<a name="243"/>  243:   ct:print(&quot;Restart all slaves with 'die' message&quot;),
<a name="244"/>  244:   [ms:to_slave(die, Index) || Index &lt;- lists:seq(1, N)],
<a name="245"/>  245:   timer:sleep(1000),
<a name="246"/>  246: 
<a name="247"/>  247:   ct:print(&quot;Send the message again to check the slaves are restarted&quot;),
<a name="248"/>  248:   [ms:to_slave(&quot;Hi, slave!&quot;, Index) || Index &lt;- lists:seq(1, N)],
<a name="249"/>  249:   timer:sleep(1000),
<a name="250"/>  250: 
<a name="251"/>  251:   ct:print(&quot;Kill the master to cleanup&quot;),
<a name="252"/>  252:   exit(whereis(master), kill),
<a name="253"/>  253:   timer:sleep(1000),
<a name="254"/>  254:   ?assertEqual(undefined, whereis(master)),
<a name="ms_test_common-last_expr"/><a name="255"/>  255: <b>  log_finish</b>(?FUNCTION_NAME).
</pre>
</body>
</html>
